Sharedlists
===========

This role installs [Sharedlists](https://github.com/foodcoops/sharedlists), a simple rails driven database for managing multiple product lists of various suppliers.

A MariaDB server needs to be installed separately.

All the Sharedlists components are started via Systemd services. Puma is used as an application server.
[Socket activation](https://github.com/puma/puma/blob/master/docs/systemd.md) is enabled.

- [Sharedlists](#sharedlists)
  - [Variables](#variables)
  - [Example Playbook](#example-playbook)


## Variables

You can adapt the role to your needs via the following variables. Please note: If there's no default you have to set this variable by yourself (e.g. at your playbook).

| Name | Default | Note |
|--|--|--|
| `sharedlists_home` | `/opt/sharedlists` | Path to install the application |
| `sharedlists_user` | `_sharedlists` | System user that runs all services |
| `sharedlists_user_home` | `/var/lib/{{ sharedlists_user }}` | Home directory for the system user |
| `sharedlists_db` | `sharedlists` | Name of the Sharedlists database |
| `sharedlists_db_user` | `sharedlists` | Name of the Sharedlists database user |
| `sharedlists_db_password` | | Database password |
| `sharedlists_environment_file` | `/etc/sharedlists/sharedlists.conf` | Sharedlists configuration file used by systemd service |
| `sharedlists_git_branch` | `main` | Sharedlists version to install |
| `sharedlists_git_url` | `https://github.com/foodcoops/sharedlists.git` | Sharedlists repository to use |
| `sharedlists_web_service` | `sharedlists-web.service` | Name of the Sharedlists systemd web service |
| `sharedlists_web_socket` | `sharedlists-web.socket` | Name of the Sharedlists systemd web socket |
| `sharedlists_secret_key_base` | autogenerated | Sharedlists Rails secret key base |
| `sharedlists_smtp_service` | `sharedlists-smtp.service` | Name of the Sharedlists systemd SMTP service |
| `sharedlists_web_bind_ip` | `127.0.0.1` | Listen address for the internal Sharedlists application server |
| `sharedlists_web_port` | `3000` | Listen port for the internal Sharedlists application server |
| `ruby_build_version` | `master` | Ruby build version to install |
| `ruby_path` | `{{ sharedlists_user_home }}/.rbenv` | Path to Ruby binaries |
| `mariadb_socket` | `/run/mysqld/mysqld.sock` | MariaDB connection socket |

## Example Playbook

```YAML
---
- name: Playbook to install Shareadlists
  hosts:
    - << your_host >>
  roles:
    - role: sharedlists
      sharedlists_db_password: abcd1234
```
